{% extends "base.html" %}
{% block title %}已上傳{% endblock %}
{% block main %}
    <script>
        const elemInterval = {}

        function imgError(elem) {
            elemInterval[elem.src] = setInterval(() => {
                elem.src = elem.src.split('?')[0] + "?t=" + Math.random();
            }, 1000)
        }

        function imgLoad(elem) {
            clearInterval(elemInterval[elem.src])
        }
    </script>
    <div class="flex flex-col w-full">
        <header class="relative inset-x-0 top-0 z-50 flex h-16 border-b border-gray-900/10">
            <div class="mx-auto flex w-full max-w-7xl items-center justify-between px-4 sm:px-6 lg:px-8">
                <div class="flex flex-1 items-center gap-x-6">
                    <button type="button" class="-m-3 p-3 md:hidden">
                        <span class="sr-only">Open main menu</span>
                        <svg class="h-5 w-5 text-gray-900" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                            <path fill-rule="evenodd"
                                  d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10zm0 5.25a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75a.75.75 0 01-.75-.75z"
                                  clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </div>
                <nav class="hidden md:flex md:gap-x-11 md:text-sm md:font-semibold md:leading-6 md:text-gray-700">
                    <a href="/my">我的上傳</a>
                    <a href="/use">上傳資料</a>
                </nav>
                <div class="flex flex-1 items-center justify-end gap-x-8">
                </div>
            </div>
        </header>
        <div class="relative my-8 px-24">
            <nav aria-label="Progress">
                <ol role="list" class="space-y-4 md:flex md:space-x-8 md:space-y-0">
                    <li class="md:flex-1">
                        <div class="group flex flex-col border-l-4 border-indigo-600 py-2 pl-4 hover:border-indigo-800 md:border-l-0 md:border-t-4 md:pb-0 md:pl-0 md:pt-4">
                            <span class="text-sm font-medium text-indigo-600 group-hover:text-indigo-800">Step 1</span>
                            <span class="text-sm font-medium">上傳資料檔</span>
                        </div>
                    </li>
                    <li class="md:flex-1">
                        <div
                                class="flex flex-col border-l-4 border-indigo-600 py-2 pl-4 md:border-l-0 md:border-t-4 md:pb-0 md:pl-0 md:pt-4"
                                aria-current="step">
                            <span class="text-sm font-medium text-indigo-600">Step 2</span>
                            <span class="text-sm font-medium">檢視圖表</span>
                        </div>
                    </li>
                </ol>
            </nav>
            <main>
                <header class="relative isolate pt-16">
                    <div class="absolute inset-0 -z-10 overflow-hidden" aria-hidden="true">
                        <div class="absolute left-16 top-full -mt-16 transform-gpu opacity-50 blur-3xl xl:left-1/2 xl:-ml-80">
                            <div class="aspect-[1154/678] w-[72.125rem] bg-gradient-to-br from-[#FF80B5] to-[#9089FC]"
                                 style="clip-path: polygon(100% 38.5%, 82.6% 100%, 60.2% 37.7%, 52.4% 32.1%, 47.5% 41.8%, 45.2% 65.6%, 27.5% 23.4%, 0.1% 35.3%, 17.9% 0%, 27.7% 23.4%, 76.2% 2.5%, 74.2% 56%, 100% 38.5%)"></div>
                        </div>
                        <div class="absolute inset-x-0 bottom-0 h-px bg-gray-900/5"></div>
                    </div>

                    <div class="mx-auto max-w-7xl px-4 py-10 sm:px-6 lg:px-8">
                        <div class="mx-auto flex max-w-2xl items-center justify-between gap-x-8 lg:mx-0 lg:max-w-none">
                            <div class="flex items-center gap-x-6">
                                <svg class="h-16 w-16 flex-none rounded-full ring-1 ring-gray-900/10 bg-gray-100 mx-auto text-gray-500 p-3"
                                     xmlns="http://www.w3.org/2000/svg"
                                     fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                                >
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0112 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M12 10.875v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125M13.125 12h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125M20.625 12c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5M12 14.625v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 14.625c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m0 1.5v-1.5m0 0c0-.621.504-1.125 1.125-1.125m0 0h7.5"></path>
                                </svg>

                                <div>
                                    <div class="text-sm leading-6 text-gray-500">資料 <span
                                            class="text-gray-700">#{{ data['id'] }}</span>
                                    </div>
                                    <div class="mt-1 text-base font-semibold leading-6 text-gray-900">{{ data['path'].split('/')[-1] }}</div>
                                </div>
                            </div>
                            <div class="flex items-center gap-x-4 sm:gap-x-6">
                                <form action="/delete/{{ data['id'] }}" method="post">
                                    <button
                                            type="submit"
                                            class="rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600">
                                        刪除
                                    </button>
                                </form>
                                <button
                                        class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
                                    分享
                                </button>

                                <div class="relative sm:hidden">
                                    <button type="button" class="-m-3 block p-3" id="more-menu-button"
                                            aria-expanded="false" aria-haspopup="true">
                                        <span class="sr-only">More</span>
                                        <svg class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor"
                                             aria-hidden="true">
                                            <path d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM10 8.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM11.5 15.5a1.5 1.5 0 10-3 0 1.5 1.5 0 003 0z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>

                <div class="mx-auto max-w-7xl px-4 py-16 sm:px-6 lg:px-8">
                    <div class="mx-auto grid max-w-2xl grid-cols-1 grid-rows-1 items-start gap-x-8 gap-y-8 lg:mx-0 lg:max-w-none lg:grid-cols-3">
                        <!-- Invoice summary -->
                        <div class="lg:col-start-3 lg:row-end-1">
                            <h2 class="sr-only">Summary</h2>
                            <div class="rounded-lg bg-gray-50 shadow-sm ring-1 ring-gray-900/5">
                                <dl class="flex flex-wrap">
                                    <div class="flex-auto pl-6 pt-6">
                                        <dt class="text-sm font-semibold leading-6 text-gray-900">產生圖表</dt>
                                        <dd class="mt-1 text-base font-semibold leading-6 text-gray-900">
                                            大小（行數）：{{ csv_data | length }}</dd>
                                    </div>
                                    <div class="mt-6 flex w-full flex-none gap-x-4 border-t border-gray-900/5 px-6 pt-6">
                                        <dt class="flex-none">
                                            <span class="sr-only">Client</span>
                                            <svg class="h-6 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"
                                                 aria-hidden="true">
                                                <path fill-rule="evenodd"
                                                      d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-5.5-2.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 12a5.99 5.99 0 00-4.793 2.39A6.483 6.483 0 0010 16.5a6.483 6.483 0 004.793-2.11A5.99 5.99 0 0010 12z"
                                                      clip-rule="evenodd"></path>
                                            </svg>
                                        </dt>
                                        <dd class="text-sm font-medium leading-6 text-gray-900">You</dd>
                                    </div>
                                    <div class="mt-4 flex w-full flex-none gap-x-4 px-6">
                                        <dt class="flex-none">
                                            <span class="sr-only">Due date</span>
                                            <svg class="h-6 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor"
                                                 aria-hidden="true">
                                                <path d="M5.25 12a.75.75 0 01.75-.75h.01a.75.75 0 01.75.75v.01a.75.75 0 01-.75.75H6a.75.75 0 01-.75-.75V12zM6 13.25a.75.75 0 00-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 00.75-.75V14a.75.75 0 00-.75-.75H6zM7.25 12a.75.75 0 01.75-.75h.01a.75.75 0 01.75.75v.01a.75.75 0 01-.75.75H8a.75.75 0 01-.75-.75V12zM8 13.25a.75.75 0 00-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 00.75-.75V14a.75.75 0 00-.75-.75H8zM9.25 10a.75.75 0 01.75-.75h.01a.75.75 0 01.75.75v.01a.75.75 0 01-.75.75H10a.75.75 0 01-.75-.75V10zM10 11.25a.75.75 0 00-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 00.75-.75V12a.75.75 0 00-.75-.75H10zM9.25 14a.75.75 0 01.75-.75h.01a.75.75 0 01.75.75v.01a.75.75 0 01-.75.75H10a.75.75 0 01-.75-.75V14zM12 9.25a.75.75 0 00-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 00.75-.75V10a.75.75 0 00-.75-.75H12zM11.25 12a.75.75 0 01.75-.75h.01a.75.75 0 01.75.75v.01a.75.75 0 01-.75.75H12a.75.75 0 01-.75-.75V12zM12 13.25a.75.75 0 00-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 00.75-.75V14a.75.75 0 00-.75-.75H12zM13.25 10a.75.75 0 01.75-.75h.01a.75.75 0 01.75.75v.01a.75.75 0 01-.75.75H14a.75.75 0 01-.75-.75V10zM14 11.25a.75.75 0 00-.75.75v.01c0 .414.336.75.75.75h.01a.75.75 0 00.75-.75V12a.75.75 0 00-.75-.75H14z"/>
                                                <path fill-rule="evenodd"
                                                      d="M5.75 2a.75.75 0 01.75.75V4h7V2.75a.75.75 0 011.5 0V4h.25A2.75 2.75 0 0118 6.75v8.5A2.75 2.75 0 0115.25 18H4.75A2.75 2.75 0 012 15.25v-8.5A2.75 2.75 0 014.75 4H5V2.75A.75.75 0 015.75 2zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75z"
                                                      clip-rule="evenodd"/>
                                            </svg>
                                        </dt>
                                        <dd class="text-sm leading-6 text-gray-500">
                                            <time datetime="{{ data['time'] }}">
                                                <script>document.write(new Date(`{{ data['time'] }}`).toLocaleString())</script>
                                            </time>
                                        </dd>
                                    </div>
                                </dl>
                                <div class="mt-6 border-t border-gray-900/5 px-6 py-6">
                                    <a href="{{ url_for('download', id=data['id']) }}"
                                       class="text-sm font-semibold leading-6 text-gray-900">下載資料
                                        <span aria-hidden="true">&rarr;</span></a>
                                </div>
                            </div>
                        </div>

                        <!-- Invoice -->
                        <div class="-mx-4 px-4 py-8 shadow-sm ring-1 ring-gray-900/5 sm:mx-0 sm:rounded-lg sm:px-8 sm:pb-14 lg:col-span-2 lg:row-span-2 lg:row-end-2 xl:px-16 xl:pb-20 xl:pt-16">
                            <h2 class="text-base font-semibold leading-6 text-gray-900">圖表資料</h2>
                            <dl class="mt-6 grid grid-cols-1 text-sm leading-6 sm:grid-cols-2">
                                <div class="sm:pr-4 col-span-2">
                                    <dt class="inline text-gray-500">上傳時間</dt>
                                    <dd class="inline text-gray-700">
                                        <time datetime="{{ data['time'] }}">
                                            <script>document.write(new Date(`{{ data['time'] }}`).toLocaleString())</script>
                                        </time>
                                    </dd>
                                </div>
                                <div class="grid grid-cols-2 w-full border col-span-2">
                                    <img src="{{ url_for('static', filename=data['id']+'-1.jpg') }}"
                                         onerror="imgError(this)"
                                         onload="imgLoad(this)"
                                         alt=""/>
                                    <img src="{{ url_for('static', filename=data['id']+'-2.jpg') }}"
                                         onerror="imgError(this)"
                                         onload="imgLoad(this)"
                                         alt=""/>
                                    <img src="{{ url_for('static', filename=data['id']+'-3.jpg') }}"
                                         onerror="imgError(this)"
                                         onload="imgLoad(this)"
                                         alt=""/>
                                    <img src="{{ url_for('static', filename=data['id']+'-4.jpg') }}"
                                         onerror="imgError(this)"
                                         onload="imgLoad(this)"
                                         alt=""/>
                                </div>
                            </dl>
                            <table class="mt-16 w-full whitespace-nowrap text-left text-sm leading-6">
                                <colgroup>
                                    <col class="w-full">
                                    <col>
                                    <col>
                                    <col>
                                </colgroup>
                                <thead class="border-b border-gray-200 text-gray-900">
                                <tr>
                                    {% for i, col in enumerate(csv_data[0]) %}
                                        {% if i == 0 %}
                                            <th scope="col" class="px-0 py-3 font-semibold">{{ col }}</th>
                                        {% else %}
                                            <th scope="col"
                                                class="hidden py-3 pl-8 pr-0 text-right font-semibold sm:table-cell">
                                                {{ col }}
                                            </th>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                                </thead>
                                <tbody>
                                {% for row in csv_data[1:] %}
                                    <tr class="border-b border-gray-100">
                                        {% for i,col in enumerate(row) %}
                                            {% if i == 0 %}
                                                <td class="max-w-0 px-0 py-5 align-top">
                                                    <div class="truncate font-medium text-gray-900">{{ col }}</div>
                                                </td>
                                            {% else %}
                                                <td class="hidden py-5 pl-2 pr-0 text-right align-top tabular-nums text-gray-700 sm:table-cell">
                                                    {{ col }}
                                                </td>
                                            {% endif %}
                                        {% endfor %}
                                    </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
{% endblock %}